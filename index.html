<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤–åŒ…å•†å·¥ç¨‹å·¥æ•¸èˆ‡åŠè»Šçµ±è¨ˆç³»çµ±</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- SheetJSï¼ˆåŒ¯å‡º Excelï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.mini.min.js"></script>

  <!-- Chart.js + DataLabels -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

  <!-- html2pdf.jsï¼ˆåŒ¯å‡º PDFï¼‰ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

  <style>
    body {
      background: #f3f4f6;
    }

    @media print {
      .no-print {
        display: none !important;
      }

      body {
        background: white !important;
      }

      table {
        font-size: 14px;
      }
    }
  </style>
</head>

<body class="min-h-screen p-4">
  <div id="root"></div>

  <!-- React ä¸»ç¨‹å¼é–‹å§‹ -->
  <script type="text/babel">
/* ---------------------------------------------------
   LocalStorage Helper
--------------------------------------------------- */
const loadData = (key, fallback) => {
  try {
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : fallback;
  } catch {
    return fallback;
  }
};

const saveData = (key, value) => {
  localStorage.setItem(key, JSON.stringify(value));
};


/* ---------------------------------------------------
   React App Component
--------------------------------------------------- */
function App() {

  /* ---------------- å·¥ç¨‹ç®¡ç† ---------------- */
  const [projects, setProjects] = React.useState(loadData("projects", []));
  const [currentProjectId, setCurrentProjectId] = React.useState(loadData("currentProjectId", ""));
  const [newProject, setNewProject] = React.useState({ number: "", name: "" });

  /* ---------------- å¤–åŒ…å•†ç®¡ç† ---------------- */
  const [vendors, setVendors] = React.useState(loadData("vendors", ["ç´˜å±•"]));
  const [currentVendor, setCurrentVendor] = React.useState(loadData("currentVendor", "ç´˜å±•"));
  const [newVendorName, setNewVendorName] = React.useState("");

  /* ---------------- å·¥æ•¸ + åŠè»Šç´€éŒ„ ---------------- */
  const [records, setRecords] = React.useState(loadData("records", []));

  /* ---------------- Modal æ§åˆ¶ ---------------- */
  const [showLaborModal, setShowLaborModal] = React.useState(false);
  const [showCraneModal, setShowCraneModal] = React.useState(false);
  const [editRecord, setEditRecord] = React.useState(null);

  /* ---------------- è¡¨å–® State ---------------- */
  const [laborForm, setLaborForm] = React.useState({
    date: "", labor: "", support: "", note: "",
  });

  const [craneForm, setCraneForm] = React.useState({
    date: "", spec: "", hr: "", note: "",
  });

  /* ---------------- é ä¼°çµ±è¨ˆï¼ˆå·¥æ•¸ + å¤šç­†åŠè»Šï¼‰ ---------------- */
  const [estimateLabor, setEstimateLabor] = React.useState(loadData("estimateLabor", ""));
  const [estimateCranes, setEstimateCranes] = React.useState(loadData("estimateCranes", []));

  const [addEstimateCrane, setAddEstimateCrane] = React.useState({
    spec: "", day: ""
  });

  /* ---------------- Auto-save ---------------- */
  React.useEffect(() => saveData("projects", projects), [projects]);
  React.useEffect(() => saveData("currentProjectId", currentProjectId), [currentProjectId]);
  React.useEffect(() => saveData("vendors", vendors), [vendors]);
  React.useEffect(() => saveData("currentVendor", currentVendor), [currentVendor]);
  React.useEffect(() => saveData("records", records), [records]);
  React.useEffect(() => saveData("estimateLabor", estimateLabor), [estimateLabor]);
  React.useEffect(() => saveData("estimateCranes", estimateCranes), [estimateCranes]);

  
/* ---------------------------------------------------
    æ–°å¢å·¥ç¨‹
--------------------------------------------------- */
const addProject = () => {
  if (!newProject.number || !newProject.name) return;

  const newId = Date.now().toString();
  const newList = [...projects, { id: newId, ...newProject }];

  setProjects(newList);
  setCurrentProjectId(newId);
  setNewProject({ number: "", name: "" });
};


/* ---------------------------------------------------
    åˆªé™¤å·¥ç¨‹ï¼ˆå«ç´€éŒ„ï¼‰
--------------------------------------------------- */
const deleteProject = () => {
  if (!currentProjectId) {
    alert("è«‹å…ˆé¸æ“‡å·¥ç¨‹ï¼");
    return;
  }

  const p = projects.find(p => p.id === currentProjectId);
  if (!p) return;

  if (!confirm(`ç¢ºå®šè¦åˆªé™¤å·¥ç¨‹ï¼š${p.number} ${p.name}ï¼Ÿ\nï¼ˆç›¸é—œç´€éŒ„ä¹Ÿæœƒä¸€èµ·åˆªé™¤ï¼‰`)) return;

  setProjects(projects.filter(p => p.id !== currentProjectId));
  setRecords(records.filter(r => r.projectId !== currentProjectId));
  setCurrentProjectId("");

  alert("å·¥ç¨‹èˆ‡ç´€éŒ„å·²åˆªé™¤ï¼");
};


/* ---------------------------------------------------
    æ–°å¢å¤–åŒ…å•†
--------------------------------------------------- */
const addVendor = () => {
  if (!newVendorName.trim()) return;
  if (vendors.includes(newVendorName)) return;

  const newList = [...vendors, newVendorName];
  setVendors(newList);
  setCurrentVendor(newVendorName);
  setNewVendorName("");
};


/* ---------------------------------------------------
    æ–°å¢å·¥æ•¸ç´€éŒ„
--------------------------------------------------- */
const addLaborRecord = () => {
  if (!laborForm.date) return;

  const newRecord = {
    id: Date.now(),
    type: "labor",
    vendor: currentVendor,
    projectId: currentProjectId,
    date: laborForm.date,
    labor: parseFloat(laborForm.labor || 0),
    support: parseFloat(laborForm.support || 0),
    spec: "",
    hr: 0,
    day: 0,
    note: laborForm.note || "",
  };

  setRecords([...records, newRecord]);
  setShowLaborModal(false);
  setLaborForm({ date: "", labor: "", support: "", note: "" });
};


/* ---------------------------------------------------
    æ–°å¢åŠè»Šç´€éŒ„
--------------------------------------------------- */
const addCraneRecord = () => {
  if (!craneForm.date || !craneForm.spec || !craneForm.hr) return;

  const hr = parseFloat(craneForm.hr);
  const day = parseFloat((hr / 8).toFixed(1));

  const newRecord = {
    id: Date.now(),
    type: "crane",
    vendor: currentVendor,
    projectId: currentProjectId,
    date: craneForm.date,
    labor: 0,
    support: 0,
    spec: craneForm.spec,
    hr,
    day,
    note: craneForm.note || "",
  };

  setRecords([...records, newRecord]);
  setShowCraneModal(false);
  setCraneForm({ date: "", spec: "", hr: "", note: "" });
};


/* ---------------------------------------------------
    ç·¨è¼¯ç´€éŒ„æ§åˆ¶
--------------------------------------------------- */
const startEditRecord = (record) => setEditRecord(record);

const deleteRecord = (id) => {
  setRecords(records.filter(r => r.id !== id));
};
/* ---------------------------------------------------
    å–å¾—ã€Œç›®å‰å·¥ç¨‹ + å¤–åŒ…å•†ã€çš„ç´€éŒ„
--------------------------------------------------- */
const projectRecords = records.filter(r =>
  r.projectId === currentProjectId && r.vendor === currentVendor
);

projectRecords.sort((a, b) => {
  if (a.date === b.date) return a.id - b.id;
  return a.date.localeCompare(b.date);
});


/* ---------------------------------------------------
    çµ±è¨ˆï¼šå·¥æ•¸åˆè¨ˆ
--------------------------------------------------- */
const totalLabor = projectRecords
  .filter(r => r.type === "labor")
  .reduce((sum, r) => sum + r.labor, 0);

const totalSupport = projectRecords
  .filter(r => r.type === "labor")
  .reduce((sum, r) => sum + r.support, 0);

const totalLaborSum = totalLabor + totalSupport;


/* ---------------------------------------------------
    å·¥æ•¸è½å·®ï¼ˆèˆ‡é ä¼°æ¯”è¼ƒï¼‰
--------------------------------------------------- */
const laborDiff = estimateLabor
  ? totalLaborSum - parseFloat(estimateLabor)
  : 0;


/* ---------------------------------------------------
    åŠè»Šçµ±è¨ˆï¼ˆä¾è¦æ ¼åŠ ç¸½å¤©æ•¸ï¼‰
--------------------------------------------------- */
const craneStats = {};
projectRecords
  .filter(r => r.type === "crane")
  .forEach(r => {
    if (!craneStats[r.spec]) craneStats[r.spec] = 0;
    craneStats[r.spec] += r.day;
  });


/* ---------------------------------------------------
    æ¨™é¡Œé¡¯ç¤º
--------------------------------------------------- */
const currentProject = projects.find(p => p.id === currentProjectId);
const titleText = currentProject
  ? `${currentVendor} - ${currentProject.number} ${currentProject.name} çµ±è¨ˆè¡¨`
  : "å°šæœªé¸æ“‡å·¥ç¨‹";


/* ---------------------------------------------------
    åœ“é¤…åœ–ï¼ˆå¤–åŒ…å·¥ vs æ”¯æ´å·¥ï¼‰
--------------------------------------------------- */
const pieRef = React.useRef(null);
const chartInstance = React.useRef(null);

React.useEffect(() => {
  if (!pieRef.current) return;

  const ctx = pieRef.current.getContext("2d");

  if (chartInstance.current) chartInstance.current.destroy();

  chartInstance.current = new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["å¤–åŒ…å·¥", "æ”¯æ´å·¥"],
      datasets: [{
        data: [totalLabor, totalSupport],
        backgroundColor: ["#3B82F6", "#FBBF24"],
      }],
    },
    plugins: [ChartDataLabels],
    options: {
      plugins: {
        datalabels: {
          color: "#000",
          formatter: (value, ctx) => {
            const total = ctx.chart.data.datasets[0].data
              .reduce((a, b) => a + b, 0);
            if (total === 0) return "0%";
            return ((value / total) * 100).toFixed(1) + "%";
          },
          font: { weight: "bold", size: 14 }
        },
        legend: { position: "bottom" }
      }
    }
  });
}, [totalLabor, totalSupport]);


/* ---------------------------------------------------
    ä¸»ç•«é¢ UIï¼ˆä¸ŠåŠï¼‰
--------------------------------------------------- */
return (
  <div className="max-w-full">

    <h1 className="text-2xl font-bold mb-4">{titleText}</h1>

    {/* ----------------------------- å·¥ç¨‹ç®¡ç† ----------------------------- */}
    <div className="bg-white p-4 rounded shadow mb-4 no-print">
      <h2 className="font-semibold mb-2">å·¥ç¨‹ç®¡ç†</h2>

      <div className="flex gap-4 items-center mb-2">
        <select
          className="border p-2 rounded"
          value={currentProjectId}
          onChange={e => setCurrentProjectId(e.target.value)}
        >
          <option value="">è«‹é¸æ“‡å·¥ç¨‹</option>
          {projects.map(p => (
            <option key={p.id} value={p.id}>
              {p.number} - {p.name}
            </option>
          ))}
        </select>

        <button
          className="bg-blue-600 text-white px-4 py-2 rounded"
          onClick={() => document.getElementById("newProject").showModal()}
        >
          æ–°å¢å·¥ç¨‹
        </button>

        <button
          className="bg-red-600 text-white px-4 py-2 rounded"
          onClick={deleteProject}
        >
          åˆªé™¤å·¥ç¨‹
        </button>
      </div>
    </div>


    {/* ----------------------------- å¤–åŒ…å•†ç®¡ç† ----------------------------- */}
    <div className="bg-white p-4 rounded shadow mb-4 no-print">
      <h2 className="font-semibold mb-2">å¤–åŒ…å•†ç®¡ç†</h2>

      <div className="flex gap-4 items-center mb-2">
        <select
          className="border p-2 rounded"
          value={currentVendor}
          onChange={e => setCurrentVendor(e.target.value)}
        >
          {vendors.map(v => (
            <option key={v} value={v}>{v}</option>
          ))}
        </select>

        <button
          className="bg-green-600 text-white px-4 py-2 rounded"
          onClick={() => document.getElementById("newVendor").showModal()}
        >
          æ–°å¢å¤–åŒ…å•†
        </button>
      </div>
    </div>


    {/* ----------------------------- æ“ä½œæŒ‰éˆ• ----------------------------- */}
    <div className="flex gap-4 mb-4 no-print">
      <button
        className="bg-blue-500 text-white px-4 py-2 rounded"
        onClick={() => setShowLaborModal(true)}
      >
        æ–°å¢å·¥æ•¸
      </button>

      <button
        className="bg-yellow-500 text-white px-4 py-2 rounded"
        onClick={() => setShowCraneModal(true)}
      >
        æ–°å¢åŠè»Š
      </button>

      <button className="bg-gray-700 text-white px-4 py-2 rounded"
        onClick={() => window.print()}>
        åˆ—å°
      </button>

      <button className="bg-red-600 text-white px-4 py-2 rounded"
        onClick={exportPDF}>
        åŒ¯å‡º PDF
      </button>

      <button className="bg-purple-600 text-white px-4 py-2 rounded"
        onClick={exportExcel}>
        åŒ¯å‡º Excel
      </button>
    </div>
{/* ************************************************************ */}
{/*                  PDF ç”¨å€å¡Š  pdfAreaï¼ˆå¯åŒ¯å‡ºï¼‰              */}
{/* ************************************************************ */}
<div id="pdfArea">

  <h1 className="text-2xl font-bold mb-4">{titleText}</h1>

  {/* ------------------------- åˆä½µæ¸…å–®è¡¨æ ¼ ------------------------- */}
  <div className="overflow-x-auto bg-white rounded shadow">
    <table className="w-full border">
      <thead className="bg-gray-200">
        <tr>
          <th className="border px-2 py-1">æ—¥æœŸ</th>
          <th className="border px-2 py-1">å¤–åŒ…å•†</th>
          <th className="border px-2 py-1">å¤–åŒ…å·¥</th>
          <th className="border px-2 py-1">æ”¯æ´å·¥</th>
          <th className="border px-2 py-1">åŠè»Šè¦æ ¼</th>
          <th className="border px-2 py-1">å¤©</th>
          <th className="border px-2 py-1">å‚™è¨»</th>
          <th className="border px-2 py-1 no-print">æ“ä½œ</th>
        </tr>
      </thead>

      <tbody>
        {projectRecords.map(r => (
          <tr key={r.id}>
            <td className="border px-2 py-1">{r.date}</td>
            <td className="border px-2 py-1">{r.vendor}</td>
            <td className="border px-2 py-1">{r.labor || ""}</td>
            <td className="border px-2 py-1">{r.support || ""}</td>
            <td className="border px-2 py-1">{r.spec || ""}</td>
            <td className="border px-2 py-1">
              {r.type === "crane" ? r.day.toFixed(1) : ""}
            </td>
            <td className="border px-2 py-1">{r.note}</td>

            <td className="border px-2 py-1 no-print">
              <button
                className="text-blue-600 mr-2"
                onClick={() => startEditRecord(r)}
              >
                ç·¨è¼¯
              </button>

              <button
                className="text-red-600"
                onClick={() => deleteRecord(r.id)}
              >
                åˆªé™¤
              </button>
            </td>
          </tr>
        ))}

        {/* å°è¨ˆåˆ— */}
        <tr className="bg-yellow-100 font-bold text-lg">
          <td className="border px-2 py-2 text-center" colSpan="2">
            å·¥æ•¸å°è¨ˆ
          </td>
          <td className="border px-2 py-2 text-blue-700">
            {totalLabor.toFixed(1)}
          </td>
          <td className="border px-2 py-2 text-blue-700">
            {totalSupport.toFixed(1)}
          </td>
          <td className="border px-2 py-2" colSpan="3"></td>
          <td className="border no-print"></td>
        </tr>
      </tbody>
    </table>
  </div>

  {/* ************************************************************ */}
  {/*                    é ä¼°å·¥æ•¸ + å¤šç­†åŠè»Šè¨­å®š                     */}
  {/* ************************************************************ */}
  <div className="bg-white p-4 rounded shadow mt-6 border-2 border-gray-300">
    <h3 className="text-lg font-extrabold mb-3 text-gray-800">
      ğŸ“Œ é ä¼°è³‡è¨Š
    </h3>

    {/* é ä¼°å·¥æ•¸ */}
    <div className="mb-4">
      <span className="font-bold">é ä¼°å·¥æ•¸ï¼š</span>
      <input
        type="number"
        value={estimateLabor}
        onChange={e => setEstimateLabor(e.target.value)}
        className="border px-2 py-1 rounded w-32"
        placeholder="è¼¸å…¥æ•¸å­—"
      />
    </div>

    {/* é ä¼°åŠè»Šï¼ˆå¤šç­†ï¼‰ */}
    <div className="mb-4">
      <div className="font-bold mb-2">é ä¼°åŠè»Šï¼ˆå¯å¤šç­†ï¼‰</div>

      {/* è¼¸å…¥æ¬„ä½ */}
      <div className="flex gap-2 mb-2">
        <input
          className="border px-2 py-1 rounded w-28"
          placeholder="è¦æ ¼ ä¾‹ï¼š45T"
          value={addEstimateCrane.spec}
          onChange={e =>
            setAddEstimateCrane({
              ...addEstimateCrane,
              spec: e.target.value
            })
          }
        />

        <input
          type="number"
          className="border px-2 py-1 rounded w-20"
          placeholder="å¤©æ•¸"
          value={addEstimateCrane.day}
          onChange={e =>
            setAddEstimateCrane({
              ...addEstimateCrane,
              day: e.target.value
            })
          }
        />

        <button
          className="px-3 py-1 bg-blue-600 text-white rounded"
          onClick={pushEstimateCrane}
        >
          æ–°å¢
        </button>
      </div>

      {/* æ¸…å–® */}
      <div className="space-y-1">
        {estimateCranes.map((c, idx) => (
          <div key={idx} className="flex items-center gap-2">
            <span className="font-semibold text-gray-800">
              {c.spec} / {c.day} å¤©
            </span>

            <button
              className="text-red-600"
              onClick={() => delEstimateCrane(idx)}
            >
              ç§»é™¤
            </button>
          </div>
        ))}
      </div>
    </div>
  </div>

  {/* ************************************************************ */}
  {/*                      çµ±è¨ˆç¸½è¦½ + è½å·®é¡¯ç¤º                     */}
  {/* ************************************************************ */}
  <div className="bg-white p-6 rounded shadow mt-6 border-2 border-gray-300 flex gap-6">

    {/* å·¦å´çµ±è¨ˆ */}
    <div className="flex-1">
      <h2 className="text-xl font-extrabold mb-4 text-gray-800">
        ğŸ“Š çµ±ã€€è¨ˆã€€ç¸½ã€€è¦½
      </h2>

      <div className="text-lg font-bold space-y-2 text-gray-900">
        <p>
          å¤–åŒ…å·¥ç¸½è¨ˆï¼š
          <span className="text-blue-700">{totalLabor.toFixed(1)}</span>
        </p>

        <p>
          æ”¯æ´å·¥ç¸½è¨ˆï¼š
          <span className="text-blue-700">{totalSupport.toFixed(1)}</span>
        </p>

        <p>
          å·¥æ•¸åˆè¨ˆï¼š
          <span className="text-red-700">{totalLaborSum.toFixed(1)}</span>
        </p>

        {/* å·¥æ•¸è½å·® */}
        <p>
          è½å·®ï¼ˆå¯¦éš› - é ä¼°ï¼‰ï¼š
          <span
            className={
              laborDiff > 0
                ? "text-red-600"
                : laborDiff < 0
                ? "text-green-600"
                : "text-gray-600"
            }
          >
            {laborDiff > 0 ? "+" : ""}
            {laborDiff.toFixed(1)}
          </span>
        </p>
      </div>

      {/* åŠè»Šçµ±è¨ˆ */}
      <h3 className="text-lg font-extrabold mt-6 mb-2 text-gray-800">
        ğŸ—ï¸ åŠè»Šçµ±è¨ˆ
      </h3>

      {Object.keys(craneStats).length === 0 && (
        <p className="text-gray-600 text-md">ç„¡åŠè»Šç´€éŒ„</p>
      )}

      <div className="space-y-1 text-lg font-bold text-gray-900">
        {Object.entries(craneStats).map(([spec, day]) => (
          <p key={spec}>
            {spec}ï¼š
            <span className="text-green-700">
              {day.toFixed(1)} å¤©
            </span>
          </p>
        ))}
      </div>
    </div>

    {/* åœ“é¤…åœ– */}
    <div className="w-64 h-64 flex justify-center items-center">
      <canvas ref={pieRef}></canvas>
    </div>
  </div>

</div> {/* pdfArea end */}
{/* ---------------------------------------------------
      React Portalï¼šé€šç”¨ Modal çµ„ä»¶
--------------------------------------------------- */}
const Modal = ({ children, onClose }) => {
  return ReactDOM.createPortal(
    <div className="fixed inset-0 bg-black/40 flex justify-center items-center z-50">
      <div className="bg-white p-4 rounded shadow w-80">
        {children}

        {/* é—œé–‰æŒ‰éˆ• */}
        <button
          className="mt-3 bg-gray-500 text-white px-4 py-2 rounded w-full"
          onClick={onClose}
        >
          é—œé–‰
        </button>
      </div>
    </div>,
    document.getElementById("modal-root")
  );
};


/* ---------------------------------------------------
      æ–°å¢å·¥æ•¸ Modal
--------------------------------------------------- */
const LaborModal = ({ onClose }) => (
  <Modal onClose={onClose}>
    <h2 className="text-lg font-bold mb-2">æ–°å¢å·¥æ•¸</h2>

    <input
      type="date"
      className="border p-2 w-full mb-2"
      value={laborForm.date}
      onChange={e => setLaborForm({ ...laborForm, date: e.target.value })}
    />

    <input
      type="number"
      className="border p-2 w-full mb-2"
      placeholder="å¤–åŒ…å·¥"
      value={laborForm.labor}
      onChange={e => setLaborForm({ ...laborForm, labor: e.target.value })}
    />

    <input
      type="number"
      className="border p-2 w-full mb-2"
      placeholder="æ”¯æ´å·¥"
      value={laborForm.support}
      onChange={e => setLaborForm({ ...laborForm, support: e.target.value })}
    />

    <input
      className="border p-2 w-full mb-2"
      placeholder="å‚™è¨»"
      value={laborForm.note}
      onChange={e => setLaborForm({ ...laborForm, note: e.target.value })}
    />

    <button
      className="bg-blue-600 text-white px-4 py-2 rounded w-full"
      onClick={addLaborRecord}
    >
      å„²å­˜
    </button>
  </Modal>
);


/* ---------------------------------------------------
      æ–°å¢åŠè»Š Modal
--------------------------------------------------- */
const CraneModal = ({ onClose }) => (
  <Modal onClose={onClose}>
    <h2 className="text-lg font-bold mb-2">æ–°å¢åŠè»Š</h2>

    <input
      type="date"
      className="border p-2 w-full mb-2"
      value={craneForm.date}
      onChange={e => setCraneForm({ ...craneForm, date: e.target.value })}
    />

    <input
      className="border p-2 w-full mb-2"
      placeholder="åŠè»Šè¦æ ¼ ä¾‹ï¼š45T"
      value={craneForm.spec}
      onChange={e => setCraneForm({ ...craneForm, spec: e.target.value })}
    />

    <input
      type="number"
      className="border p-2 w-full mb-2"
      placeholder="HRï¼ˆå°æ™‚ï¼‰"
      value={craneForm.hr}
      onChange={e => setCraneForm({ ...craneForm, hr: e.target.value })}
    />

    <input
      className="border p-2 w-full mb-2"
      placeholder="å‚™è¨»"
      value={craneForm.note}
      onChange={e => setCraneForm({ ...craneForm, note: e.target.value })}
    />

    <button
      className="bg-yellow-600 text-white px-4 py-2 rounded w-full"
      onClick={addCraneRecord}
    >
      å„²å­˜
    </button>
  </Modal>
);


/* ---------------------------------------------------
      ç·¨è¼¯ç´€éŒ„ Modal
--------------------------------------------------- */
const EditModal = ({ onClose }) => (
  <Modal onClose={onClose}>
    <h2 className="text-lg font-bold mb-2">ç·¨è¼¯ç´€éŒ„</h2>

    <input
      type="date"
      className="border p-2 w-full mb-2"
      value={editRecord.date}
      onChange={e => setEditRecord({ ...editRecord, date: e.target.value })}
    />

    {editRecord.type === "labor" ? (
      <>
        <input
          type="number"
          className="border p-2 w-full mb-2"
          placeholder="å¤–åŒ…å·¥"
          value={editRecord.labor}
          onChange={e =>
            setEditRecord({
              ...editRecord,
              labor: parseFloat(e.target.value || 0)
            })
          }
        />

        <input
          type="number"
          className="border p-2 w-full mb-2"
          placeholder="æ”¯æ´å·¥"
          value={editRecord.support}
          onChange={e =>
            setEditRecord({
              ...editRecord,
              support: parseFloat(e.target.value || 0)
            })
          }
        />
      </>
    ) : (
      <>
        <input
          className="border p-2 w-full mb-2"
          placeholder="åŠè»Šè¦æ ¼"
          value={editRecord.spec}
          onChange={e => setEditRecord({ ...editRecord, spec: e.target.value })}
        />

        <input
          type="number"
          className="border p-2 w-full mb-2"
          placeholder="HR"
          value={editRecord.hr}
          onChange={e => {
            const hr = parseFloat(e.target.value || 0);
            const day = parseFloat((hr / 8).toFixed(1));
            setEditRecord({ ...editRecord, hr, day });
          }}
        />
      </>
    )}

    {/* å‚™è¨» */}
    <input
      className="border p-2 w-full mb-2"
      placeholder="å‚™è¨»"
      value={editRecord.note}
      onChange={e => setEditRecord({ ...editRecord, note: e.target.value })}
    />

    <button
      className="bg-green-600 text-white px-4 py-2 rounded w-full"
      onClick={() => {
        setRecords(
          records.map(r => (r.id === editRecord.id ? editRecord : r))
        );
        setEditRecord(null);
      }}
    >
      å„²å­˜ä¿®æ”¹
    </button>
  </Modal>
);


/* ---------------------------------------------------
      ReactDOM Render
--------------------------------------------------- */
ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  <!-- ç”¨ä¾†æ”¾ç½® React Portal æ¨¡æ…‹è¦–çª—çš„å®¹å™¨ -->
  <div id="modal-root"></div>

</body>
</html>
